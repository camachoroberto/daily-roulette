# Diagramas de Arquitetura - Daily Roulette

## ğŸ”„ Fluxo Completo de RequisiÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚
â”‚  (Cliente)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ HTTP Request
       â”‚ (Cookie: room_session)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Next.js Application (Vercel)               â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Frontend (React Components)              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”‚
â”‚  â”‚  â”‚  Pages  â”‚  â”‚Componentsâ”‚  â”‚  Hooks   â”‚       â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚  â”‚
â”‚  â”‚       â”‚            â”‚             â”‚              â”‚  â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚
â”‚  â”‚                   â”‚                             â”‚  â”‚
â”‚  â”‚                   â–¼                             â”‚  â”‚
â”‚  â”‚         fetch('/api/rooms/[slug]/spin')         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                                 â”‚
â”‚                      â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Backend (Route Handlers)                 â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚  1. Extrai cookie (room_session)                 â”‚  â”‚
â”‚  â”‚  2. Verifica JWT (lib/auth.ts)                  â”‚  â”‚
â”‚  â”‚  3. Valida dados (Zod)                          â”‚  â”‚
â”‚  â”‚  4. Executa lÃ³gica de negÃ³cio                    â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                                 â”‚
â”‚                      â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Data Layer (Prisma ORM)                  â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚  db.participant.findMany()                       â”‚  â”‚
â”‚  â”‚  db.$transaction([...])                          â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ SQL Query
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   PostgreSQL    â”‚
              â”‚   (Supabase)    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› Arquitetura de Camadas Detalhada

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CAMADA DE APRESENTAÃ‡ÃƒO                       â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Pages      â”‚  â”‚  Components  â”‚  â”‚    Hooks     â”‚            â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚            â”‚
â”‚  â”‚ â€¢ page.tsx   â”‚  â”‚ â€¢ roulette   â”‚  â”‚ â€¢ useToast   â”‚            â”‚
â”‚  â”‚ â€¢ room/[slug]â”‚  â”‚ â€¢ winner-cardâ”‚  â”‚ â€¢ useSound   â”‚            â”‚
â”‚  â”‚              â”‚  â”‚ â€¢ ui/*       â”‚  â”‚              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                 â”‚                  â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                           â”‚                                         â”‚
â”‚                           â–¼                                         â”‚
â”‚                  fetch('/api/...')                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTP/JSON
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CAMADA DE API                                â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Route      â”‚  â”‚ Validation   â”‚  â”‚  Auth        â”‚            â”‚
â”‚  â”‚   Handlers   â”‚  â”‚   (Zod)      â”‚  â”‚  (JWT)       â”‚            â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚            â”‚
â”‚  â”‚ â€¢ POST /spin â”‚  â”‚ â€¢ Schemas    â”‚  â”‚ â€¢ verifyJWT  â”‚            â”‚
â”‚  â”‚ â€¢ GET /rooms â”‚  â”‚ â€¢ safeParse  â”‚  â”‚ â€¢ requireAuthâ”‚            â”‚
â”‚  â”‚ â€¢ POST /auth â”‚  â”‚              â”‚  â”‚              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                 â”‚                  â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                           â”‚                                         â”‚
â”‚                           â–¼                                         â”‚
â”‚              successResponse() / errorResponse()                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ Prisma Client
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       CAMADA DE DADOS                               â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Prisma     â”‚  â”‚  Migrations   â”‚  â”‚  PostgreSQL  â”‚            â”‚
â”‚  â”‚    ORM       â”‚  â”‚              â”‚  â”‚  (Supabase)  â”‚            â”‚
â”‚  â”‚              â”‚  â”‚ â€¢ Versioned  â”‚  â”‚              â”‚            â”‚
â”‚  â”‚ â€¢ Type-safe  â”‚  â”‚ â€¢ Schema     â”‚  â”‚ â€¢ Relational â”‚            â”‚
â”‚  â”‚ â€¢ Queries    â”‚  â”‚   changes    â”‚  â”‚ â€¢ ACID       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Fluxo de AutenticaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cliente â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. POST /api/rooms/[slug]/auth
     â”‚    Body: { passcode: "senha123" }
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Route Handler (auth)           â”‚
â”‚                                     â”‚
â”‚  1. Valida body (Zod)              â”‚
â”‚  2. Busca Room por slug            â”‚
â”‚  3. Compara senha (bcrypt.compare) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Se vÃ¡lida:
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      lib/auth.ts                    â”‚
â”‚                                     â”‚
â”‚  createRoomSession(roomId)          â”‚
â”‚    â””â”€> SignJWT({ roomId })          â”‚
â”‚        â””â”€> Token JWT                â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Response + Cookie              â”‚
â”‚                                     â”‚
â”‚  Set-Cookie: room_session=<JWT>     â”‚
â”‚  httpOnly: true                     â”‚
â”‚  secure: true (prod)                â”‚
â”‚  maxAge: 7 dias                     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Cookie armazenado no browser
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cliente â”‚ (Autenticado)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PrÃ³ximas requisiÃ§Ãµes incluem cookie automaticamente
```

---

## ğŸ° Fluxo de Sorteio (Spin)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend â”‚
â”‚ (Button) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ POST /api/rooms/[slug]/spin
     â”‚ Cookie: room_session=<JWT>
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Route Handler (spin/route.ts)     â”‚
â”‚                                     â”‚
â”‚  1. Verifica sessÃ£o (JWT)           â”‚
â”‚  2. Busca participantes presentes   â”‚
â”‚  3. Valida (deve ter >= 1)          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Seleciona vencedor aleatÃ³rio
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TransaÃ§Ã£o Prisma (AtÃ´mica)        â”‚
â”‚                                     â”‚
â”‚  db.$transaction([                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ 1. Cria SpinHistory         â”‚  â”‚
â”‚    â”‚    - roomId                 â”‚  â”‚
â”‚    â”‚    - participantId          â”‚  â”‚
â”‚    â”‚    - createdAt              â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ 2. Incrementa winCount      â”‚  â”‚
â”‚    â”‚    participant.winCount++   â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  ])                                 â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Retorna { winner, spinHistory }
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Frontend                    â”‚
â”‚                                     â”‚
â”‚  1. Recebe resultado                â”‚
â”‚  2. Define winnerId (state)        â”‚
â”‚  3. Componente Roulette anima      â”‚
â”‚  4. ApÃ³s animaÃ§Ã£o:                 â”‚
â”‚     - Atualiza histÃ³rico            â”‚
â”‚     - Mostra WinnerCard             â”‚
â”‚     - Recarrega participantes       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ Modelo de Dados (ER)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Room                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  id: String (CUID)                 â”‚
â”‚  name: String                      â”‚
â”‚  slug: String (UNIQUE)             â”‚
â”‚  passcodeHash: String              â”‚
â”‚  createdAt: DateTime               â”‚
â”‚  updatedAt: DateTime              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 1:N
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                â”‚
       â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Participant  â”‚  â”‚ SpinHistory  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ id: String   â”‚  â”‚ id: String   â”‚
â”‚ roomId: FK   â”‚  â”‚ roomId: FK   â”‚
â”‚ name: String â”‚  â”‚ participantIdâ”‚
â”‚ isPresent:   â”‚  â”‚    : FK      â”‚
â”‚   Boolean    â”‚  â”‚ createdAt:   â”‚
â”‚ winCount:    â”‚  â”‚   DateTime    â”‚
â”‚   Int        â”‚  â”‚              â”‚
â”‚ createdAt:   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   DateTime   â”‚
â”‚ updatedAt:   â”‚
â”‚   DateTime   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:N
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SpinHistory  â”‚ (jÃ¡ mostrado acima)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Relacionamentos:
- Room â†’ Participant (1:N, Cascade Delete)
- Room â†’ SpinHistory (1:N, Cascade Delete)
- Participant â†’ SpinHistory (1:N, Cascade Delete)
```

---

## ğŸ¨ Componente Roulette (Canvas)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Componente Roulette                 â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         Canvas (HTML5)                â”‚ â”‚
â”‚  â”‚                                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚
â”‚  â”‚  â”‚                            â”‚     â”‚ â”‚
â”‚  â”‚  â”‚      [Ponteiro Fixo]       â”‚     â”‚ â”‚
â”‚  â”‚  â”‚           â¬†                â”‚     â”‚ â”‚
â”‚  â”‚  â”‚                            â”‚     â”‚ â”‚
â”‚  â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚     â”‚ â”‚
â”‚  â”‚  â”‚    â”‚              â”‚       â”‚     â”‚ â”‚
â”‚  â”‚  â”‚    â”‚   Setores    â”‚       â”‚     â”‚ â”‚
â”‚  â”‚  â”‚    â”‚   (Cores)    â”‚       â”‚     â”‚ â”‚
â”‚  â”‚  â”‚    â”‚              â”‚       â”‚     â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚     â”‚ â”‚
â”‚  â”‚  â”‚                            â”‚     â”‚ â”‚
â”‚  â”‚  â”‚      [CÃ­rculo Central]     â”‚     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚
â”‚  â”‚                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚
â”‚  Estado:                                    â”‚
â”‚  - rotation: number (graus)                 â”‚
â”‚  - isAnimating: boolean                     â”‚
â”‚  - winnerId: string | null                  â”‚
â”‚                                             â”‚
â”‚  FunÃ§Ãµes:                                   â”‚
â”‚  - drawRoulette()                           â”‚
â”‚  - getWinnerAngle()                         â”‚
â”‚  - animate() (requestAnimationFrame)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Fluxo de AnimaÃ§Ã£o:
1. winnerId definido â†’ calcula Ã¢ngulo final
2. Inicia animaÃ§Ã£o (5 voltas + ajuste)
3. Easing ease-out-cubic (3s)
4. onSpinComplete() apÃ³s animaÃ§Ã£o
```

---

## ğŸ”„ Ciclo de Vida de uma RequisiÃ§Ã£o

```
Request
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Next.js Router â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€> Route Handler encontrado?
         â”‚   â”‚
         â”‚   â”œâ”€ NÃƒO â†’ 404
         â”‚   â”‚
         â”‚   â””â”€ SIM
         â”‚       â”‚
         â”‚       â–¼
         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   â”‚  Route Handler  â”‚
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚
         â”‚            â”œâ”€> ValidaÃ§Ã£o (Zod)
         â”‚            â”‚   â”‚
         â”‚            â”‚   â”œâ”€ InvÃ¡lido â†’ 400
         â”‚            â”‚   â”‚
         â”‚            â”‚   â””â”€ VÃ¡lido
         â”‚            â”‚       â”‚
         â”‚            â”‚       â–¼
         â”‚            â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚   â”‚  AutenticaÃ§Ã£o?  â”‚
         â”‚            â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚            â”‚
         â”‚            â”‚            â”œâ”€ SIM â†’ Verifica JWT
         â”‚            â”‚            â”‚   â”‚
         â”‚            â”‚            â”‚   â”œâ”€ InvÃ¡lido â†’ 401
         â”‚            â”‚            â”‚   â”‚
         â”‚            â”‚            â”‚   â””â”€ VÃ¡lido
         â”‚            â”‚            â”‚       â”‚
         â”‚            â”‚            â””â”€ NÃƒO
         â”‚            â”‚                â”‚
         â”‚            â”‚                â–¼
         â”‚            â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚            â”‚  LÃ³gica NegÃ³cio â”‚
         â”‚            â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚                     â”‚
         â”‚            â”‚                     â–¼
         â”‚            â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚                 â”‚  Prisma Query   â”‚
         â”‚            â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚                          â”‚
         â”‚            â”‚                          â–¼
         â”‚            â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚                      â”‚   PostgreSQL   â”‚
         â”‚            â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚                               â”‚
         â”‚            â”‚                               â–¼
         â”‚            â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚                          â”‚   Response      â”‚
         â”‚            â”‚                          â”‚   {ok, data}    â”‚
         â”‚            â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚                                     â”‚
         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    Response
```

---

## ğŸ“¦ Estrutura de MÃ³dulos

```
lib/
â”œâ”€â”€ db.ts              â”€â”€> Prisma Client (Singleton)
â”œâ”€â”€ auth.ts            â”€â”€> JWT (create, verify, require)
â”œâ”€â”€ apiResponse.ts     â”€â”€> PadronizaÃ§Ã£o de respostas
â”œâ”€â”€ errors.ts          â”€â”€> AppError e helpers
â”œâ”€â”€ validations.ts     â”€â”€> Schemas Zod
â””â”€â”€ utils.ts           â”€â”€> FunÃ§Ãµes utilitÃ¡rias

app/api/
â””â”€â”€ rooms/
    â”œâ”€â”€ route.ts       â”€â”€> CRUD de salas
    â””â”€â”€ [slug]/
        â”œâ”€â”€ route.ts           â”€â”€> GET/DELETE sala
        â”œâ”€â”€ auth/route.ts      â”€â”€> AutenticaÃ§Ã£o
        â”œâ”€â”€ participants/      â”€â”€> CRUD participantes
        â”œâ”€â”€ spin/route.ts      â”€â”€> LÃ³gica de sorteio
        â”œâ”€â”€ history/route.ts   â”€â”€> HistÃ³rico
        â””â”€â”€ reset/route.ts     â”€â”€> Reset sala

components/
â”œâ”€â”€ roulette.tsx       â”€â”€> Canvas da roleta
â”œâ”€â”€ winner-card.tsx    â”€â”€> Card do vencedor
â””â”€â”€ ui/                â”€â”€> shadcn/ui components
```

---

## ğŸš€ Deploy Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Git    â”‚
â”‚  Push    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vercel CI/CD   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€> Instala dependÃªncias (npm install)
         â”‚
         â”œâ”€> Gera Prisma Client (prisma generate)
         â”‚
         â”œâ”€> Build Next.js (next build)
         â”‚
         â””â”€> Deploy para produÃ§Ã£o
             â”‚
             â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Vercel  â”‚
         â”‚  Edge    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Ãšltima atualizaÃ§Ã£o**: Janeiro 2026
